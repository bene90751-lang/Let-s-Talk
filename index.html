<script>
// Firebase config
const firebaseConfig = {
  apiKey: "AIzaSyBMKrFDt5uvRDjTDDeaRKQQHXNrwc0SAEo",
  authDomain: "let-s-talk-e57c6.firebaseapp.com",
  databaseURL: "https://let-s-talk-e57c6-default-rtdb.firebaseio.com",
  projectId: "let-s-talk-e57c6",
  storageBucket: "let-s-talk-e57c6.appspot.com",
  messagingSenderId: "958080107908",
  appId: "1:958080107908:web:d9b11b958af59bb315c9d1"
};

// Initialize Firebase
firebase.initializeApp(firebaseConfig);
const auth = firebase.auth();
const db = firebase.database();
const storage = firebase.storage();

// Login
loginBtn.addEventListener('click', () => {
  const email = emailField.value.trim();
  const password = passwordField.value.trim();
  if(!email || !password) { authMessage.textContent = 'Enter email & password'; return; }

  auth.signInWithEmailAndPassword(email, password)
    .then(userCredential => {
      // Successfully logged in
      console.log("Login success:", userCredential.user.email);
    })
    .catch(err => authMessage.textContent = err.message);
});

// Signup
signupBtn.addEventListener('click', () => {
  const email = emailField.value.trim();
  const password = passwordField.value.trim();
  if(!email || !password) { authMessage.textContent = 'Enter email & password'; return; }

  auth.createUserWithEmailAndPassword(email, password)
    .then(userCredential => {
      console.log("Signup success:", userCredential.user.email);
    })
    .catch(err => authMessage.textContent = err.message);
});

// Auth listener
auth.onAuthStateChanged(user => {
  if(user){
    // Show chat
    authContainer.style.display = 'none';
    chatContainer.style.display = 'flex';
    listenMessages(user.uid); // Pass UID to listen messages
  } else {
    authContainer.style.display = 'flex';
    chatContainer.style.display = 'none';
  }
});

// Get chat reference for 2 users
function getChatRef(uid){
  const otherUID = 'Maria_or_Zee'; // replace manually for now or fetch
  return db.ref('chats/'+ [uid, otherUID].sort().join('_'));
}

// Send a message
sendBtn.addEventListener('click', () => {
  const text = inputField.value.trim();
  if(!text) return;
  const user = auth.currentUser;
  const chatRef = getChatRef(user.uid);
  chatRef.push({ sender: user.email, text, timestamp: Date.now() });
  inputField.value='';
});

// Listen messages
function listenMessages(uid){
  const chatRef = getChatRef(uid);
  chatRef.on('child_added', snap => {
    const msg = snap.val();
    addMessage(snap.key, msg);
  });
}
                       </script>
